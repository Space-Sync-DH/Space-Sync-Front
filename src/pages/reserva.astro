---
// src/pages/index.astro
import Navbar from '../components/Navbar_User.astro';
import Sidebar from '../components/Slidebar_User.astro';
import '../styles/global.css';
---

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva de Espacios</title>
    <link rel="icon" href="/logo.png" type="image/x-icon" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.4.0/flowbite.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-r from-teal-500 via-emerald-500 to-blue-500 text-black font-sans">

    <div class="flex">
        <!-- Sidebar -->
        <Sidebar />

        <!-- Main Content -->
        <div class="flex-1 flex flex-col ml-64"> <!-- Margen para el sidebar -->
            <!-- Navbar -->
            <Navbar />

            <div class="container mx-auto p-8 flex-1">
                <h2 class="text-xl font-semibold mb-4">¡Haz tu Reserva!</h2>
                <form id="reservation-form" class="space-y-4">
                    <div>
                        <label for="date" class="block text-gray-700">Fecha</label>
                        <input type="date" id="date" required class="mt-1 p-2 border border-gray-300 rounded w-full">
                    </div>
                    <div>
                        <label for="capacity" class="block text-gray-700">Capacidad</label>
                        <select id="capacity" required class="mt-1 p-2 border border-gray-300 rounded w-full">
                            <option value="" disabled selected>Selecciona la capacidad</option>
                            <option value="2">2 personas</option>
                            <option value="4">4 personas</option>
                            <option value="6">6 personas</option>
                            <option value="8">8 personas</option>
                        </select>
                    </div>
                    <button type="submit" class="bg-blue-600 text-white p-2 rounded">Buscar Espacios</button>
                </form>

                <div id="available-spaces" class="bg-white shadow-md rounded-lg p-6 mt-6">
                    <h2 class="text-xl font-semibold mb-4">Espacios Disponibles</h2>
                    <div id="date-display" class="mb-4 text-lg font-semibold hidden"></div>
                    <ul id="spaces-list" class="space-y-4">
                        <!-- Aquí se llenarán los espacios disponibles -->
                    </ul>
                </div>

                <!-- Modal de confirmación -->
                <div id="confirmation-modal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <h3 class="text-lg font-semibold mb-4">Confirmación de Reserva</h3>
                        <p id="modal-message" class="mb-4"></p>
                        <div class="flex justify-end">
                            <button id="confirm-button" class="bg-blue-600 text-white px-4 py-2 rounded mr-2">Confirmar</button>
                            <button id="cancel-button" class="bg-red-600 text-white px-4 py-2 rounded">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentReservation = {};

        document.getElementById('reservation-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const date = document.getElementById('date').value;
            const capacity = document.getElementById('capacity').value;

            // Mostrar la fecha seleccionada
            const dateDisplay = document.getElementById('date-display');
            dateDisplay.textContent = `Fecha seleccionada: ${date}`;
            dateDisplay.classList.remove('hidden');

            // Simulando la búsqueda de espacios disponibles
            const availableSpaces = [
                {
                    name: "Sala de Reuniones A", 
                    capacity: 4, 
                    timeSlots: ["8:00 - 9:30", "9:40 - 10:50", "11:00 - 12:10", "12:20 - 13:30", "13:40 - 14:40"],
                    description: "Sala ideal para reuniones corporativas.",
                    features: "Mesa, 4 sillas, proyector, pizarra."
                },
                {
                    name: "Sala de Capacitación B", 
                    capacity: 6, 
                    timeSlots: ["10:00 - 11:30", "12:00 - 13:30", "14:00 - 15:30"],
                    description: "Espacio para talleres y capacitaciones.",
                    features: "Mesa, 6 sillas con ruedas, estante con notebooks."
                },
                {
                    name: "Espacio Creativo C", 
                    capacity: 2, 
                    timeSlots: ["9:00 - 10:30", "11:00 - 12:30"],
                    description: "Ideal para brainstorming.",
                    features: "Mesa pequeña, 2 sillas, pizarra."
                }
            ].filter(space => space.capacity <= capacity);

            const spacesList = document.getElementById('spaces-list');
            spacesList.innerHTML = '';

            if (availableSpaces.length > 0) {
                availableSpaces.forEach(space => {
                    const listItem = document.createElement('li');
                    listItem.className = 'p-4 border border-gray-300 rounded';
                    listItem.innerHTML = `
                        <strong>${space.name}</strong> - Capacidad: ${space.capacity} personas<br>
                        Descripción: ${space.description}<br>
                        Características: ${space.features}<br>
                        <div class="mt-2">
                            ${space.timeSlots.map(slot => `
                                <button class="bg-green-600 text-white p-2 rounded mt-1 mr-2" onclick="openConfirmationModal('${space.name}', '${slot}')">${slot}</button>
                            `).join('')}
                        </div>
                    `;
                    spacesList.appendChild(listItem);
                });
            } else {
                spacesList.innerHTML = '<li class="p-4 text-gray-500">No hay espacios disponibles.</li>';
            }
        });

        function openConfirmationModal(spaceName, timeSlot) {
            currentReservation = { spaceName, timeSlot };
            const modalMessage = document.getElementById('modal-message');
            modalMessage.textContent = `¿Estás seguro de que deseas reservar "${spaceName}" en la franja horaria ${timeSlot}?`;
            document.getElementById('confirmation-modal').classList.remove('hidden');
        }

        document.getElementById('confirm-button').addEventListener('click', function() {
            const { spaceName, timeSlot } = currentReservation;
            alert(`Reserva confirmada para ${spaceName} en la franja horaria ${timeSlot}.`);
            markAsReserved(spaceName, timeSlot);
            closeModal();
        });

        document.getElementById('cancel-button').addEventListener('click', closeModal);

        function closeModal() {
            document.getElementById('confirmation-modal').classList.add('hidden');
        }

        function markAsReserved(spaceName, timeSlot) {
            const spacesList = document.getElementById('spaces-list');
            const items = spacesList.querySelectorAll('li');

            items.forEach(item => {
                if (item.innerText.includes(spaceName)) {
                    const buttons = item.querySelectorAll('button');
                    buttons.forEach(button => {
                        if (button.innerText === timeSlot) {
                            button.className = 'bg-red-600 text-white p-2 rounded mt-1 mr-2 cursor-not-allowed opacity-50';
                            button.setAttribute('disabled', 'true'); // Deshabilitar el botón
                        }
                    });
                }
            });
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.4.0/flowbite.min.js"></script>
</body>
</html>
