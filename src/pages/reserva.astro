---
import '../styles/global.css';
import Footer from '../Layouts/Footer.astro';
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva - Space Sync</title>
    <link rel="icon" href="/logo.png" type="image/x-icon" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body class="bg-gradient-to-r from-teal-500 via-emerald-500 to-blue-500 text-black font-sans">

    <div class="container mx-auto mt-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-3xl font-bold">Bienvenido/a</h2>
            <button id="cerrarSesion" class="bg-red-500 text-white font-bold py-2 px-4 rounded" onclick="cerrarSesion()">Cerrar Sesión</button>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-2">Selecciona Fecha</h2>
            <form id="reservaForm" class="mb-4">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="fecha" class="block mb-1">Fecha:</label>
                        <input type="date" id="fecha" required class="border border-gray-300 rounded p-2">
                    </div>
                </div>
                <button type="submit" class="bg-blue-500 text-white font-bold py-2 px-4 rounded">Ver Disponibilidad</button>
            </form>

            <h2 class="text-xl font-semibold mb-2">Salas Disponibles</h2>
            <div id="salasDisponibles" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Aquí se mostrarán las salas y sus horarios -->
            </div>

            <h2 class="text-xl font-semibold mb-2">Historial de Reservas</h2>
            <table class="min-w-full bg-white border border-gray-300 mb-4" id="historialReservas">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border border-gray-300 px-4 py-2">Sala</th>
                        <th class="border border-gray-300 px-4 py-2">Fecha</th>
                        <th class="border border-gray-300 px-4 py-2">Hora</th>
                        <th class="border border-gray-300 px-4 py-2">Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se añadirán las reservas -->
                </tbody>
            </table>

            <h2 class="text-xl font-semibold mb-2">Comentarios</h2>
            <form id="comentarioForm" class="mb-4">
                <textarea id="comentario" class="border border-gray-300 rounded w-full p-2 mb-2" placeholder="Deja tu comentario aquí..."></textarea>
                <button type="submit" class="bg-blue-500 text-white font-bold py-2 px-4 rounded">Enviar Comentario</button>
            </form>

            <h3 class="text-lg font-semibold mb-2">Comentarios Recientes:</h3>
            <div id="comentariosRecientes" class="bg-white rounded-lg shadow-lg p-4 mb-4">
                <!-- Comentarios visibles para el admin -->
            </div>

            <!-- Nueva sección para que el admin responda -->
            <h3 class="text-lg font-semibold mb-2">Respuestas del Administrador:</h3>
            <div id="respuestasAdmin" class="bg-white rounded-lg shadow-lg p-4">
                <!-- Aquí se mostrarán las respuestas del administrador -->
            </div>
        </div>
    </div>

    <script>
        const reservaForm = document.getElementById('reservaForm');
        const comentarioForm = document.getElementById('comentarioForm');
        
        let reservas = [];
        let comentarios = [];

        // Detalles de las salas
        const detallesSalas = {
            'Sala 1': { tvs: 2, sillas: 30, mesas: 5, computadores: 10, pizarra: 1, plumones: 5, borrador: 1 },
            'Sala 2': { tvs: 1, sillas: 25, mesas: 4, computadores: 8, pizarra: 1, plumones: 4, borrador: 1 },
            'Sala 3': { tvs: 0, sillas: 20, mesas: 3, computadores: 5, pizarra: 1, plumones: 3, borrador: 1 },
            'Laboratorio 5': { tvs: 1, sillas: 15, mesas: 2, computadores: 10, pizarra: 1, plumones: 2, borrador: 1 },
            'CITT': { tvs: 3, sillas: 40, mesas: 6, computadores: 15, pizarra: 1, plumones: 5, borrador: 1 }
        };

        function verificarDisponibilidad(fecha) {
            const horas = ["08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00"];
            const salas = Object.keys(detallesSalas);

            document.getElementById('salasDisponibles').innerHTML = '';

            salas.forEach(sala => {
                const salaDiv = document.createElement('div');
                salaDiv.classList.add('border', 'border-gray-300', 'p-4', 'rounded', 'mb-4', 'bg-white', 'shadow-lg');
                const tituloSala = document.createElement('h3');
                tituloSala.classList.add('text-lg', 'font-bold');
                tituloSala.textContent = sala;
                salaDiv.appendChild(tituloSala);

                // Detalles de la sala
                const detallesDiv = document.createElement('div');
                detallesDiv.classList.add('mb-4');
                detallesDiv.innerHTML = `
                    <h4 class="font-bold mb-2">Detalle</h4>
                    <div><i class="fas fa-tv"></i> ${detallesSalas[sala].tvs} TVs</div>
                    <div><i class="fas fa-chair"></i> ${detallesSalas[sala].sillas} Sillas</div>
                    <div><i class="fas fa-table"></i> ${detallesSalas[sala].mesas} Mesas</div>
                    <div><i class="fas fa-desktop"></i> ${detallesSalas[sala].computadores} Computadores</div>
                    <div><i class="fas fa-chalkboard"></i> ${detallesSalas[sala].pizarra} Pizarra</div>
                    <div><i class="fas fa-marker"></i> ${detallesSalas[sala].plumones} Plumones</div>
                    <div><i class="fas fa-eraser"></i> ${detallesSalas[sala].borrador} Borrador</div>
                `;
                salaDiv.appendChild(detallesDiv);

                horas.forEach(hora => {
                    const horaDiv = document.createElement('div');
                    horaDiv.classList.add('inline-block', 'border', 'rounded', 'py-2', 'px-4', 'mr-2', 'mb-2', 'cursor-pointer');
                    horaDiv.textContent = hora;

                    if (reservas.some(reserva => reserva.sala === sala && reserva.fecha === fecha && reserva.hora === hora)) {
                        horaDiv.classList.add('hora-ocupada');
                        horaDiv.textContent += ' - Ocupada';
                    } else {
                        horaDiv.classList.add('hora-disponible');
                        horaDiv.onclick = () => {
                            if (confirm(`¿Estás seguro que deseas reservar la ${sala} para el ${fecha} a las ${hora}?`)) {
                                reservas.push({ sala, fecha, hora });
                                actualizarHistorialReservas();
                                verificarDisponibilidad(fecha);
                            }
                        };
                    }

                    salaDiv.appendChild(horaDiv);
                });

                document.getElementById('salasDisponibles').appendChild(salaDiv);
            });
        }

        reservaForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const fecha = document.getElementById('fecha').value;
            if (fecha) {
                verificarDisponibilidad(fecha);
            }
        });

        function actualizarHistorialReservas() {
            const historialReservas = document.getElementById('historialReservas').getElementsByTagName('tbody')[0];
            historialReservas.innerHTML = '';

            reservas.forEach((reserva, index) => {
                const row = historialReservas.insertRow();
                row.insertCell(0).textContent = reserva.sala;
                row.insertCell(1).textContent = reserva.fecha;
                row.insertCell(2).textContent = reserva.hora;
                const accionCell = row.insertCell(3);
                const eliminarBtn = document.createElement('button');
                eliminarBtn.textContent = 'Eliminar';
                eliminarBtn.classList.add('bg-red-500', 'text-white', 'font-bold', 'py-2', 'px-4', 'rounded');
                eliminarBtn.onclick = () => {
                    if (confirm('¿Estás seguro que deseas eliminar esta reserva?')) {
                        reservas.splice(index, 1);
                        actualizarHistorialReservas();
                    }
                };
                accionCell.appendChild(eliminarBtn);
            });
        }

        comentarioForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const comentario = document.getElementById('comentario').value;
            if (comentario) {
                comentarios.push({ texto: comentario, respuesta: null });
                actualizarComentarios();
            }
        });

        function actualizarComentarios() {
            const comentariosRecientes = document.getElementById('comentariosRecientes');
            comentariosRecientes.innerHTML = '';
            const respuestasAdmin = document.getElementById('respuestasAdmin');
            respuestasAdmin.innerHTML = '';

            comentarios.forEach((comentario, index) => {
                const comentarioDiv = document.createElement('div');
                comentarioDiv.classList.add('mb-4');
                comentarioDiv.innerHTML = `<strong>Comentario:</strong> ${comentario.texto}`;
                comentariosRecientes.appendChild(comentarioDiv);

                // Espacio para respuesta del administrador
                const respuestaInput = document.createElement('textarea');
                respuestaInput.classList.add('border', 'border-gray-300', 'rounded', 'w-full', 'p-2', 'mb-2');
                respuestaInput.placeholder = 'Responder como administrador...';
                respuestaInput.value = comentario.respuesta || '';

                const enviarRespuestaBtn = document.createElement('button');
                enviarRespuestaBtn.textContent = 'Enviar Respuesta';
                enviarRespuestaBtn.classList.add('bg-blue-500', 'text-white', 'font-bold', 'py-2', 'px-4', 'rounded');
                enviarRespuestaBtn.onclick = () => {
                    comentario.respuesta = respuestaInput.value;
                    actualizarComentarios();
                };

                respuestasAdmin.appendChild(respuestaInput);
                respuestasAdmin.appendChild(enviarRespuestaBtn);
            });
        }

        function cerrarSesion() {
            if (confirm('¿Estás seguro que deseas cerrar sesión?')) {
                window.location.href = '/';
            }
        }
    </script>

    <Footer />
</body>
</html>
